<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8">
<meta name="viewport"
      content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<title>大調音階｜三和弦級數練習</title>

<style>
*{ box-sizing:border-box; }

html, body{
  margin:0;
  height:100%;
  overflow:hidden;
  overscroll-behavior:none;
  touch-action:none;
}

body{
  background:#0f1115;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",
               Roboto,"Noto Sans TC","PingFang TC",sans-serif;
}

/* ===== 核心尺寸策略 ===== */
:root{
  --gap: 6px;
  --gutter: clamp(16px, 4vw, 28px);
  --boardMax: 400px;
  --labelSpace: 34px;
  --colLabelH: 26px;

  --boardWidth: min(
    calc(100vw - (var(--gutter) * 2)),
    var(--boardMax)
  );

  --cell: clamp(
    28px,
    calc((var(--boardWidth) - var(--labelSpace) - (var(--gap) * 6)) / 7 * 0.92),
    52px
  );
}

.wrapper{
  max-width:560px;
  margin:0 auto;
  padding:12px;
}

h1{
  text-align:center;
  font-size:16px;
  margin:6px 0 12px;
}

/* ===== 棋盤 ===== */
.board-wrap{
  display:flex;
  justify-content:center;
  margin-bottom:14px;
}

.board-container{
  width: var(--boardWidth);
  padding-left: var(--labelSpace);
}

.board{ position:relative; }

.row-labels{
  position:absolute;
  top: var(--colLabelH);
  left: calc(-1 * var(--labelSpace));
  width: var(--labelSpace);
  display:flex;
  flex-direction:column;
  gap: var(--gap);
  align-items:flex-end;
  pointer-events:none;
}

.row-label{
  height: var(--cell);
  font-size:12px;
  font-weight:800;
  opacity:.85;
  display:flex;
  align-items:center;
}

.grid-board{
  display:grid;
  grid-template-columns:repeat(7,var(--cell));
  grid-template-rows:var(--colLabelH) repeat(3,var(--cell));
  gap:var(--gap);
}

.col-label{
  display:flex;
  align-items:flex-end;
  justify-content:center;
  font-size:12px;
  font-weight:800;
  opacity:.9;
}

.cell{
  width:var(--cell);
  height:var(--cell);
  border:1px dashed rgba(255,255,255,.4);
  border-radius:10px;
  position:relative;
}

.cell.highlight{
  border-color:#6fbaff;
  background:rgba(111,186,255,.15);
}

/* ===== 音名區 ===== */
.palette{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.row{
  display:grid;
  grid-template-columns:repeat(7,var(--cell));
  gap:var(--gap);
  justify-content:center;
}

.tile{
  width:var(--cell);
  height:var(--cell);
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  user-select:none;
  touch-action:none;
}

.palette-tile{ background:#8a8f98; }

.dragging{
  position:fixed;
  z-index:9999;
  pointer-events:none;
  transform:translate(-50%,-50%);
  background:#9aa0a8;
}

.placed{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  background:#6e7680;
}

/* ===== 全部刪除 ===== */
.clear-all{
  position:fixed;
  right:16px;
  bottom:16px;
  padding:12px 14px;
  border-radius:14px;
  background:rgba(255,255,255,.12);
  border:1px solid rgba(255,255,255,.2);
  color:#fff;
  font-weight:800;
}
</style>
</head>

<body>
<div class="wrapper">
  <h1>大調音階・三和弦級數練習</h1>

  <div class="board-wrap">
    <div class="board-container">
      <div class="board">
        <div class="row-labels">
          <div class="row-label">5</div>
          <div class="row-label">3</div>
          <div class="row-label">R</div>
        </div>

        <div class="grid-board">
          <div class="col-label">1</div>
          <div class="col-label">2m</div>
          <div class="col-label">3m</div>
          <div class="col-label">4</div>
          <div class="col-label">5</div>
          <div class="col-label">6m</div>
          <div class="col-label">7m♭5</div>

          <!-- 3 排 × 7 -->
          <div class="cell"></div><div class="cell"></div><div class="cell"></div>
          <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>

          <div class="cell"></div><div class="cell"></div><div class="cell"></div>
          <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>

          <div class="cell"></div><div class="cell"></div><div class="cell"></div>
          <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        </div>
      </div>
    </div>
  </div>

  <!-- 音名三排 -->
  <div class="palette" id="palette">
    <div class="row">
      <div class="tile palette-tile" data-note="C">C</div>
      <div class="tile palette-tile" data-note="D">D</div>
      <div class="tile palette-tile" data-note="E">E</div>
      <div class="tile palette-tile" data-note="F">F</div>
      <div class="tile palette-tile" data-note="G">G</div>
      <div class="tile palette-tile" data-note="A">A</div>
      <div class="tile palette-tile" data-note="B">B</div>
    </div>
    <div class="row">
      <div class="tile palette-tile" data-note="C#">C#</div>
      <div class="tile palette-tile" data-note="D#">D#</div>
      <div class="tile palette-tile" data-note="E#">E#</div>
      <div class="tile palette-tile" data-note="F#">F#</div>
      <div class="tile palette-tile" data-note="G#">G#</div>
      <div class="tile palette-tile" data-note="A#">A#</div>
      <div class="tile palette-tile" data-note="B#">B#</div>
    </div>
    <div class="row">
      <div class="tile palette-tile" data-note="Cb">Cb</div>
      <div class="tile palette-tile" data-note="Db">Db</div>
      <div class="tile palette-tile" data-note="Eb">Eb</div>
      <div class="tile palette-tile" data-note="Fb">Fb</div>
      <div class="tile palette-tile" data-note="Gb">Gb</div>
      <div class="tile palette-tile" data-note="Ab">Ab</div>
      <div class="tile palette-tile" data-note="Bb">Bb</div>
    </div>
  </div>
</div>

<button id="clearAllBtn" class="clear-all">全部刪除</button>

<script>
/* 防止背景捲動 */
document.addEventListener('touchmove', e => e.preventDefault(), {passive:false});

const cells = [...document.querySelectorAll('.cell')];
let dragEl=null, dragNote=null, overCell=null;

function clearHighlight(){
  cells.forEach(c=>c.classList.remove('highlight'));
}
function cleanup(){
  document.querySelectorAll('.dragging').forEach(e=>e.remove());
  dragEl=dragNote=overCell=null;
}
function startDrag(note,x,y){
  cleanup();
  dragNote=note;
  dragEl=document.createElement('div');
  dragEl.className='tile dragging';
  dragEl.textContent=note;
  document.body.appendChild(dragEl);
  dragEl.style.left=x+'px';
  dragEl.style.top=y+'px';
}

/* 從音名拖 */
document.getElementById('palette').addEventListener('touchstart',e=>{
  const t=e.target.closest('.palette-tile');
  if(!t) return;
  e.preventDefault();
  const p=e.touches[0];
  startDrag(t.dataset.note,p.clientX,p.clientY);
},{passive:false});

/* 從已放置的音名拖出（拖出即刪） */
document.addEventListener('touchstart', e => {
  const placed = e.target.closest('.placed');
  if(!placed) return;

  e.preventDefault();

  const touch = e.touches[0];
  const note = placed.textContent;

  // 先把原本放在格子裡的刪掉
  placed.remove();

  // 立刻進入拖曳狀態
  startDrag(note, touch.clientX, touch.clientY);
}, { passive:false });

      
/* 拖曳中 */
document.addEventListener('touchmove',e=>{
  if(!dragEl) return;
  const p=e.touches[0];
  dragEl.style.left=p.clientX+'px';
  dragEl.style.top=p.clientY+'px';
  const c=document.elementFromPoint(p.clientX,p.clientY)?.closest('.cell');
  if(c!==overCell){
    overCell=c;
    clearHighlight();
    if(overCell) overCell.classList.add('highlight');
  }
},{passive:false});

/* 放手 */
document.addEventListener('touchend',()=>{
  if(!dragEl) return;
  clearHighlight();
  if(overCell){
    overCell.innerHTML='';
    const el=document.createElement('div');
    el.className='tile placed';
    el.textContent=dragNote;
    overCell.appendChild(el);
  }
  cleanup();
},{passive:false});

/* 全部刪除 */
document.getElementById('clearAllBtn').onclick=()=>{
  cells.forEach(c=>c.innerHTML='');
  cleanup();
};
</script>
</body>
</html>
