<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>å¤§èª¿éŸ³éšï½œä¸‰å’Œå¼¦ç´šæ•¸ç·´ç¿’</title>

<style>
:root{
  --gap: 6px;
  --side: 12px;

  /* è®“å°æ‰‹æ©Ÿä¹Ÿä¸æ“ çˆ† */
  --cell: clamp(
  28px,
  calc((100vw - (var(--side) * 2) - (var(--labelW) + var(--labelGap)) - (var(--gap) * 6)) / 7),
  64px
);


  /* å·¦å´åˆ—æ¨™ç±¤ï¼šåŠ å¯¬é¿å… Root æ“ å‡º */
  --labelW: clamp(56px, 16vw, 68px);
  --labelGap: 10px;

  /* ä¸Šæ–¹æ¬„æ¨™é«˜åº¦åŠ ä¸€é»ï¼Œé¿å…æ“ åˆ°æ ¼å­ */
  --colLabelH: 28px;
}

*{ box-sizing:border-box; }

/* âœ… å›ºå®šèƒŒæ™¯/ç‰ˆé¢ï¼šç¦æ­¢æ²å‹•èˆ‡å›å½ˆ */
html, body{
  height:100%;
  overflow:hidden;
  overscroll-behavior:none;
  touch-action:none;
}

body{
  margin:0;
  background:#0f1115;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC",sans-serif;
}

.wrapper{
  max-width:560px;
  margin:0 auto;
  padding:12px;
  height:100%;
  overflow:hidden;
}

h1{
  font-size:16px;
  text-align:center;
  margin:6px 0 12px;
}

/* ===== ä¸Šæ–¹æ£‹ç›¤ï¼šä»¥ã€Œ7æ¬„ã€ç‚ºä¸­å¿ƒå°é½Š ===== */
.board-wrap{
  display:flex;
  justify-content:center; /* ğŸ”‘ è®“ 7 æ¬„æ£‹ç›¤èˆ‡ä¸‹æ–¹ç­”æ¡ˆæ ¼åŒä¸­å¿ƒ */
  margin-bottom:14px;
}

.board{
  position:relative;
  padding-left: calc(var(--labelW) + var(--labelGap)); /* é ç•™å·¦å´æ¨™ç±¤ç©ºé–“ï¼Œä¸æ”¹è®Šæ£‹ç›¤ä¸­å¿ƒ */
}

/* çœŸæ­£æ£‹ç›¤ï¼šåªæœ‰ 7 æ¬„ */
.grid-board{
  display:grid;
  grid-template-columns: repeat(7, var(--cell));
  grid-template-rows: var(--colLabelH) repeat(3, var(--cell));
  gap: var(--gap);
  justify-content:center;
}

/* ä¸Šæ–¹æ¬„æ¨™ï¼šè‡ªé©æ‡‰å­—ç´šã€æ°¸ä¸è¶…å‡º */
.col-label{
  height: var(--colLabelH);
  display:flex;
  align-items:flex-end;
  justify-content:center;
  font-size: clamp(10px, 2.8vw, 12px);
  font-weight:800;
  color:rgba(255,255,255,.88);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  line-height:1;
}

/* å·¦å´åˆ—æ¨™ï¼šä¸ä½” grid æ¬„ä½ï¼Œç¨ç«‹è²¼ä¸Š */
.row-labels{
  position:absolute;
  left: 0;
  top: var(--colLabelH);
  width: var(--labelW);
  display:flex;
  flex-direction:column;
  gap: var(--gap);
  padding-right: var(--labelGap);
  align-items:flex-end;
}

.row-label{
  height: var(--cell);
  display:flex;
  align-items:center;
  justify-content:flex-end;
  font-size: clamp(10px, 2.8vw, 12px);
  font-weight:800;
  color: rgba(255,255,255,.82);
  white-space:nowrap;
  overflow:hidden;
  text-overflow:ellipsis;
  line-height:1;
}

/* 7Ã—3 ç©ºç™½æ ¼ */
.cell{
  width:var(--cell);
  height:var(--cell);
  border:1px dashed rgba(255,255,255,.4);
  border-radius:10px;
  position:relative;
}

.cell.highlight{
  border-color:#6fbaff;
  background:rgba(111,186,255,.15);
}

/* ===== ä¸‹æ–¹ç­”æ¡ˆæ ¼ï¼ˆéŸ³åï¼‰ ===== */
.palette{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.row{
  display:grid;
  grid-template-columns:repeat(7,var(--cell));
  gap:var(--gap);
  justify-content:center;
}

.tile{
  width:var(--cell);
  height:var(--cell);
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  user-select:none;
  touch-action:none;
}

.palette-tile{
  background:#8a8f98;
  color:#fff;
}

/* æ‹–æ›³ä¸­çš„æ–¹å¡Š */
.dragging{
  position:fixed;
  z-index:9999;
  pointer-events:none;
  transform:translate(-50%,-50%);
  background:#9aa0a8;
}

/* å·²æ”¾ç½® */
.placed{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  background:#6e7680;
}

/* å³ä¸‹è§’å…¨éƒ¨åˆªé™¤ */
.clear-all{
  position:fixed;
  right:14px;
  bottom:14px;
  z-index:1000;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.12);
  color:#fff;
  font-weight:800;
}
.clear-all:active{ transform:translateY(1px); }

/* å°è¢å¹•å†ç¸®ä¸€ä¸‹å·¦æ¨™ï¼Œé¿å…æ“ çˆ† */
@media (max-width: 380px){
  :root{ --labelW: 60px; --labelGap: 8px; }
}
</style>
</head>

<body>
<div class="wrapper">
  <h1>å¤§èª¿éŸ³éšãƒ»ä¸‰å’Œå¼¦ç´šæ•¸ç·´ç¿’</h1>

  <!-- ä¸Šæ–¹æ£‹ç›¤ï¼ˆ7æ¬„èˆ‡ä¸‹æ–¹ç­”æ¡ˆæ ¼å°é½Šï¼‰ -->
  <div class="board-wrap">
    <div class="board">
      <!-- å·¦å´åˆ—æ¨™ï¼ˆä¸Šï¼š5th / ä¸­ï¼š3rd / ä¸‹ï¼šRootï¼‰ -->
      <div class="row-labels" aria-hidden="true">
        <div class="row-label">5th</div>
        <div class="row-label">3rd</div>
        <div class="row-label">Root</div>
      </div>

      <!-- æ¬„æ¨™ + 7Ã—3 -->
      <div class="grid-board" id="gridBoard">
        <div class="col-label">1</div>
        <div class="col-label">2m</div>
        <div class="col-label">3m</div>
        <div class="col-label">4</div>
        <div class="col-label">5</div>
        <div class="col-label">6m</div>
        <div class="col-label">7mâ™­5</div>

        <!-- ç¬¬ 1 æ’ï¼ˆ5thï¼‰ -->
        <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <!-- ç¬¬ 2 æ’ï¼ˆ3rdï¼‰ -->
        <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
        <!-- ç¬¬ 3 æ’ï¼ˆRootï¼‰ -->
        <div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
      </div>
    </div>
  </div>

  <!-- éŸ³å -->
  <div class="palette" id="palette">
    <div class="row">
      <div class="tile palette-tile" data-note="C">C</div>
      <div class="tile palette-tile" data-note="D">D</div>
      <div class="tile palette-tile" data-note="E">E</div>
      <div class="tile palette-tile" data-note="F">F</div>
      <div class="tile palette-tile" data-note="G">G</div>
      <div class="tile palette-tile" data-note="A">A</div>
      <div class="tile palette-tile" data-note="B">B</div>
    </div>
    <div class="row">
      <div class="tile palette-tile" data-note="C#">C#</div>
      <div class="tile palette-tile" data-note="D#">D#</div>
      <div class="tile palette-tile" data-note="E#">E#</div>
      <div class="tile palette-tile" data-note="F#">F#</div>
      <div class="tile palette-tile" data-note="G#">G#</div>
      <div class="tile palette-tile" data-note="A#">A#</div>
      <div class="tile palette-tile" data-note="B#">B#</div>
    </div>
    <div class="row">
      <div class="tile palette-tile" data-note="Cb">Cb</div>
      <div class="tile palette-tile" data-note="Db">Db</div>
      <div class="tile palette-tile" data-note="Eb">Eb</div>
      <div class="tile palette-tile" data-note="Fb">Fb</div>
      <div class="tile palette-tile" data-note="Gb">Gb</div>
      <div class="tile palette-tile" data-note="Ab">Ab</div>
      <div class="tile palette-tile" data-note="Bb">Bb</div>
    </div>
  </div>
</div>

<button id="clearAllBtn" class="clear-all">å…¨éƒ¨åˆªé™¤</button>

<script>
/* âœ… å¼·åˆ¶é˜²æ­¢æ•´é åœ¨æ‹–æ›³æ™‚æ²å‹•/å›å½ˆï¼ˆèƒŒæ™¯å›ºå®šï¼‰ */
document.addEventListener('touchmove', (e) => {
  e.preventDefault();
}, { passive: false });

const cells = [...document.querySelectorAll('.cell')];

let dragEl = null;
let dragNote = null;
let overCell = null;

/* å·¥å…· */
function clearHighlight(){
  cells.forEach(c => c.classList.remove('highlight'));
}

function findCell(x, y){
  const el = document.elementFromPoint(x, y);
  return el && el.classList.contains('cell') ? el : el?.closest('.cell');
}

function cleanupDragging(){
  document.querySelectorAll('.dragging').forEach(el => el.remove());
  dragEl = null;
  dragNote = null;
  overCell = null;
}

function startDrag(note, x, y){
  cleanupDragging();

  dragNote = note;
  dragEl = document.createElement('div');
  dragEl.className = 'tile dragging';
  dragEl.textContent = dragNote;
  document.body.appendChild(dragEl);

  dragEl.style.left = x + 'px';
  dragEl.style.top  = y + 'px';
}

/* å¾éŸ³åå€æ‹– */
document.getElementById('palette').addEventListener('touchstart', (e) => {
  const t = e.target.closest('.palette-tile');
  if(!t) return;
  e.preventDefault();

  const touch = e.touches[0];
  startDrag(t.dataset.note, touch.clientX, touch.clientY);
}, { passive:false });

/* å¾å·²æ”¾ç½®æ–¹å¡Šæ‹–å‡ºï¼ˆæ‹–å‡ºæ”¾æ‰‹å³æ¶ˆå¤±ï¼‰ */
document.addEventListener('touchstart', (e) => {
  const placed = e.target.closest('.placed');
  if(!placed) return;
  e.preventDefault();

  const touch = e.touches[0];
  const note = placed.textContent;

  placed.remove();
  startDrag(note, touch.clientX, touch.clientY);
}, { passive:false });

/* æ‹–æ›³ä¸­ */
document.addEventListener('touchmove', (e) => {
  if(!dragEl) return;

  const touch = e.touches[0];
  dragEl.style.left = touch.clientX + 'px';
  dragEl.style.top  = touch.clientY + 'px';

  const cell = findCell(touch.clientX, touch.clientY);
  if(cell !== overCell){
    overCell = cell;
    clearHighlight();
    if(overCell) overCell.classList.add('highlight');
  }
}, { passive:false });

/* æ”¾æ‰‹ */
document.addEventListener('touchend', () => {
  if(!dragEl) return;

  clearHighlight();

  if(overCell){
    overCell.innerHTML = '';
    const placed = document.createElement('div');
    placed.className = 'tile placed';
    placed.textContent = dragNote;
    overCell.appendChild(placed);
  }

  cleanupDragging();
}, { passive:false });

/* è§¸æ§ä¸­æ–·ä¿åº• */
document.addEventListener('touchcancel', () => {
  clearHighlight();
  cleanupDragging();
}, { passive:false });

/* å…¨éƒ¨åˆªé™¤ */
document.getElementById('clearAllBtn').addEventListener('click', () => {
  cells.forEach(c => c.innerHTML = '');
  clearHighlight();
  cleanupDragging();
});
</script>
</body>
</html>
