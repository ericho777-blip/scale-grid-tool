<!doctype html>
<html lang="zh-Hant">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no" />
<title>å¤§èª¿éŸ³éšï½œä¸‰å’Œå¼¦ç´šæ•¸è¡¨</title>

<style>
/* ===== æ‰‹æ©Ÿç›´å¼å„ªå…ˆï¼ˆå«å·¦å´æ¨™ç±¤æ¬„ï¼‰===== */
:root{
  --gap: 6px;
  --side: 12px;
  --labelW: clamp(54px, 15vw, 78px); /* å·¦å´ Root/3rd/5th æ¬„å¯¬ */
  --cell: clamp(
    32px,
    calc((100vw - (var(--side) * 2) - var(--labelW) - (var(--gap) * 7)) / 7),
    64px
  );
}

*{ box-sizing:border-box; }

body{
  margin:0;
  background:#0f1115;
  color:#fff;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Noto Sans TC","PingFang TC",sans-serif;
}

.wrapper{
  max-width:520px;
  margin:0 auto;
  padding:12px;
}

h1{
  font-size:16px;
  text-align:center;
  margin:6px 0 12px;
}

/* ===== å¤–å±¤ã€Œå«æ¨™ç±¤ã€çš„æ£‹ç›¤ï¼š8 æ¬„ï¼ˆå·¦æ¨™ç±¤+7æ ¼ï¼‰Ã— 4 åˆ—ï¼ˆä¸Šæ¨™ç±¤+3æ ¼ï¼‰===== */
.grid-board{
  display:grid;
  grid-template-columns: var(--labelW) repeat(7, var(--cell));
  grid-template-rows: auto repeat(3, var(--cell));
  gap: var(--gap);
  justify-content:center;
  margin-bottom:14px;
}

/* å·¦ä¸Šè§’ç©ºç™½ */
.corner{
  height: 24px;
}

/* ä¸Šæ–¹æ¬„æ¨™ */
.col-label{
  height: 24px;
  display:flex;
  align-items:flex-end;
  justify-content:center;
  font-size: 12px;
  font-weight: 700;
  color: rgba(255,255,255,.82);
  letter-spacing: .2px;
}

/* å·¦å´åˆ—æ¨™ */
.row-label{
  width: var(--labelW);
  height: var(--cell);
  display:flex;
  align-items:center;
  justify-content:flex-end;
  padding-right: 8px;
  font-size: 12px;
  font-weight: 800;
  color: rgba(255,255,255,.80);
}

/* 7Ã—3 æ ¼å­ */
.cell{
  width:var(--cell);
  height:var(--cell);
  border:1px dashed rgba(255,255,255,.4);
  border-radius:10px;
  position:relative;
}

.cell.highlight{
  border-color:#6fbaff;
  background:rgba(111,186,255,.15);
}

/* ===== éŸ³åå€ ===== */
.palette{
  display:flex;
  flex-direction:column;
  gap:8px;
}

.row{
  display:grid;
  grid-template-columns:repeat(7,var(--cell));
  gap:var(--gap);
  justify-content:center;
}

.tile{
  width:var(--cell);
  height:var(--cell);
  border-radius:10px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:700;
  user-select:none;
  touch-action:none;
}

.palette-tile{
  background:#8a8f98;
  color:#fff;
}

/* æ‹–æ›³ä¸­çš„æ–¹å¡Š */
.dragging{
  position:fixed;
  z-index:9999;
  pointer-events:none;
  transform:translate(-50%,-50%);
  background:#9aa0a8;
}

/* å·²æ”¾ç½® */
.placed{
  position:absolute;
  left:50%;
  top:50%;
  transform:translate(-50%,-50%);
  background:#6e7680;
}

/* å³ä¸‹è§’å…¨éƒ¨åˆªé™¤ */
.clear-all{
  position:fixed;
  right:14px;
  bottom:14px;
  z-index:1000;
  padding:12px 14px;
  border-radius:14px;
  border:1px solid rgba(255,255,255,.2);
  background:rgba(255,255,255,.12);
  color:#fff;
  font-weight:800;
}
.clear-all:active{ transform:translateY(1px); }
/* ===== ä¸Šæ–¹æ£‹ç›¤å°é½Šä¸‹æ–¹ç­”æ¡ˆæ ¼ ===== */
.board-wrap{
  position: relative;
  display: flex;
  justify-content: center; /* ğŸ”‘ ä»¥ 7 æ¬„ç‚ºä¸­å¿ƒ */
  margin-bottom: 14px;
}

/* å·¦å´ Root / 3rd / 5th */
.row-labels{
  position: absolute;
  left: calc(50% - (var(--cell) * 3.5) - 48px); /* è²¼åœ¨ 7 æ¬„å·¦é‚Š */
  top: 24px; /* å°é½Šç¬¬ä¸€æ’æ ¼å­ */
  display: flex;
  flex-direction: column;
  gap: var(--gap);
}

.row-label{
  height: var(--cell);
  display: flex;
  align-items: center;
  justify-content: flex-end;
  padding-right: 6px;
  font-size: 12px;
  font-weight: 800;
  color: rgba(255,255,255,.8);
}

/* çœŸæ­£çš„ 7Ã—3 */
.grid-board{
  display: grid;
  grid-template-columns: repeat(7, var(--cell));
  grid-template-rows: 24px repeat(3, var(--cell));
  gap: var(--gap);
  justify-content: center;
}

  
</style>
</head>

<body>
<div ="wrapper">
  <h1>å¤§èª¿éŸ³éšãƒ»ä¸‰å’Œå¼¦ç´šæ•¸ç·´ç¿’</h1>

  <!-- å«æ¨™ç±¤çš„æ£‹ç›¤ -->
  <div ="grid-board" id="gridBoard">
    <!-- å·¦ä¸Šè§’ -->
    <div ="corner"></div>

    <!-- ä¸Šæ–¹ 7 æ¬„æ¨™ç±¤ -->
    <div ="col-label">1</div>
    <div ="col-label">2m</div>
    <div ="col-label">3m</div>
    <div ="col-label">4</div>
    <div ="col-label">5</div>
    <div class="col-label">6m</div>
    <div class="col-label">7mb5</div>

    <!-- ç¬¬ 1 åˆ—ï¼š5thï¼ˆæœ€ä¸Šï¼‰ -->
<div class="row-label">5th</div>
<div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>

<!-- ç¬¬ 2 åˆ—ï¼š3rd -->
<div class="row-label">3rd</div>
<div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>

<!-- ç¬¬ 3 åˆ—ï¼šRootï¼ˆæœ€ä¸‹ï¼‰ -->
<div class="row-label">Root</div>
<div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div><div class="cell"></div>
</div>

  <!-- éŸ³å -->
  <div class="palette" id="palette">
    <div class="row">
      <div class="tile palette-tile" data-note="C">C</div>
      <div class="tile palette-tile" data-note="D">D</div>
      <div class="tile palette-tile" data-note="E">E</div>
      <div class="tile palette-tile" data-note="F">F</div>
      <div class="tile palette-tile" data-note="G">G</div>
      <div class="tile palette-tile" data-note="A">A</div>
      <div class="tile palette-tile" data-note="B">B</div>
    </div>
    <div class="row">
      <div class="tile palette-tile" data-note="C#">C#</div>
      <div class="tile palette-tile" data-note="D#">D#</div>
      <div class="tile palette-tile" data-note="E#">E#</div>
      <div class="tile palette-tile" data-note="F#">F#</div>
      <div class="tile palette-tile" data-note="G#">G#</div>
      <div class="tile palette-tile" data-note="A#">A#</div>
      <div class="tile palette-tile" data-note="B#">B#</div>
    </div>
    <div class="row">
      <div class="tile palette-tile" data-note="Cb">Cb</div>
      <div class="tile palette-tile" data-note="Db">Db</div>
      <div class="tile palette-tile" data-note="Eb">Eb</div>
      <div class="tile palette-tile" data-note="Fb">Fb</div>
      <div class="tile palette-tile" data-note="Gb">Gb</div>
      <div class="tile palette-tile" data-note="Ab">Ab</div>
      <div class="tile palette-tile" data-note="Bb">Bb</div>
    </div>
  </div>
</div>

<button id="clearAllBtn" class="clear-all">å…¨éƒ¨åˆªé™¤</button>

<script>
const cells = [...document.querySelectorAll('.cell')];

let dragEl = null;
let dragNote = null;
let overCell = null;

/* å·¥å…· */
function clearHighlight(){
  cells.forEach(c => c.classList.remove('highlight'));
}
function findCell(x, y){
  const el = document.elementFromPoint(x, y);
  return el && el.classList.contains('cell') ? el : el?.closest('.cell');
}
function cleanupDrag(){
  clearHighlight();
  if (dragEl) dragEl.remove();
  dragEl = null;
  dragNote = null;
  overCell = null;
}
function startDrag(note, x, y){
  // é¿å…æ®˜ç•™çš„ dragEl é€ æˆé¬¼å½±
  cleanupDrag();

  dragNote = note;
  dragEl = document.createElement('div');
  dragEl.className = 'tile dragging';
  dragEl.textContent = dragNote;
  document.body.appendChild(dragEl);

  // âœ… é—œéµï¼štouchstart ç•¶ä¸‹å°±å®šä½ï¼Œé¿å…å·¦å´/å·¦ä¸Šè§’å†’å‡ºã€Œå¤šä¸€é¡†ã€
  dragEl.style.left = x + 'px';
  dragEl.style.top  = y + 'px';
}

/* 1) å¾éŸ³åå€æ‹– */
document.getElementById('palette').addEventListener('touchstart', e => {
  const t = e.target.closest('.palette-tile');
  if(!t) return;
  e.preventDefault();

  const touch = e.touches[0];
  startDrag(t.dataset.note, touch.clientX, touch.clientY);
}, { passive:false });

/* 2) å¾å·²æ”¾ç½®æ–¹å¡Šæ‹–å‡ºï¼ˆæ‹–å‡ºæ”¾æ‰‹å³åˆªé™¤ï¼‰ */
document.addEventListener('touchstart', e => {
  const placed = e.target.closest('.placed');
  if(!placed) return;
  e.preventDefault();

  const touch = e.touches[0];
  startDrag(placed.textContent, touch.clientX, touch.clientY);
  placed.remove(); // å…ˆæ‹¿æ‰ï¼›è‹¥æ²’æ”¾å›æ ¼å­ï¼åˆªé™¤
}, { passive:false });

/* æ‹–æ›³ä¸­ */
document.addEventListener('touchmove', e => {
  if(!dragEl) return;
  e.preventDefault();

  const touch = e.touches[0];
  dragEl.style.left = touch.clientX + 'px';
  dragEl.style.top  = touch.clientY + 'px';

  const cell = findCell(touch.clientX, touch.clientY);
  if(cell !== overCell){
    overCell = cell;
    clearHighlight();
    if(overCell) overCell.classList.add('highlight');
  }
}, { passive:false });

/* æ”¾æ‰‹ï¼šæœ‰æ”¾åˆ°æ ¼å­å°±æ”¾å…¥ï¼Œæ²’æ”¾åˆ°å°±æ¶ˆå¤± */
document.addEventListener('touchend', () => {
  if(!dragEl) return;

  if(overCell){
    overCell.innerHTML = '';
    const placed = document.createElement('div');
    placed.className = 'tile placed';
    placed.textContent = dragNote;
    overCell.appendChild(placed);
  }
  cleanupDrag();
}, { passive:false });

/* âœ… é‡è¦ï¼šé‡åˆ°ä¾†é›»/åˆ‡App/ç³»çµ±ä¸­æ–·æ™‚ï¼Œä¹Ÿè¦æ¸…æ‰æ‹–æ›³æ®˜å½± */
document.addEventListener('touchcancel', () => {
  cleanupDrag();
}, { passive:false });

/* å…¨éƒ¨åˆªé™¤ï¼šæ¸…ç©ºæ ¼å­ + åŒæ™‚æ¸…æ‰ä»»ä½•å¡ä½çš„æ‹–æ›³æ–¹å¡Š */
document.getElementById('clearAllBtn').addEventListener('click', () => {
  cells.forEach(c => c.innerHTML = '');
  cleanupDrag();
});
</script>

</body>
</html>
